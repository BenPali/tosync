<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tosync Private - Watch together, stay connected</title>

    <!-- Socket.IO for real-time communication -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Tosync Private</h1>
            <p>Watch together, stay connected</p>
        </div>

        <!-- Landing Page (Guest Join Only) -->
        <div class="landing-page hidden" id="landingPage" style="display: none;">
            <div class="landing-container" style="max-width: 500px;">
                <div class="landing-header">
                    <h1>Tosync Private</h1>
                    <p>Watch together, stay connected</p>
                </div>

                <div class="landing-card">
                    <h3>üîó Join Room as Guest</h3>
                    <p>Enter a 32-character room code to join</p>
                    <div class="form-group">
                        <input type="text" id="roomCodeInput" placeholder="Enter room code" maxlength="32"
                            style="text-transform: uppercase; font-family: monospace; font-size: 0.9rem;">
                    </div>
                    <button class="btn secondary" id="joinRoomBtn">Join Room</button>
                    <div id="joinError" class="alert error hidden" style="margin-top: 12px;">Invalid room code</div>
                </div>

                <div style="text-align: center; margin-top: 24px; color: #718096;">
                    <p>Need to create a room? <a href="/login" style="color: #3182ce; text-decoration: none;">Login as Admin</a></p>
                </div>
            </div>
        </div>

        <!-- Room Management (After Login) -->
        <div class="section room-selector hidden" id="roomSelector">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <div>
                    <h3>Welcome, <span id="loggedInUsername"></span></h3>
                    <p style="color: #718096; margin-top: 4px;">Create a new room or join an existing one</p>
                </div>
                <button class="btn secondary small" id="logoutBtn">Logout</button>
            </div>

            <div class="room-options">
                <!-- Create Room -->
                <div class="room-option-card">
                    <h4>üé¨ Create New Room</h4>
                    <p>Start a new watch party with full admin controls</p>
                    <button class="btn" id="createRoomBtn">Create Room</button>
                </div>

                <!-- Join Room -->
                <div class="room-option-card">
                    <h4>üîó Join Existing Room</h4>
                    <p>Enter a 32-character room code</p>
                    <div class="form-group">
                        <input type="text" id="adminRoomCodeInput" placeholder="Enter room code" maxlength="32"
                            style="text-transform: uppercase; font-family: monospace; font-size: 0.85rem;">
                    </div>
                    <button class="btn secondary" id="adminJoinRoomBtn">Join Room</button>
                    <div id="adminJoinError" class="alert error hidden" style="margin-top: 12px;">Invalid room code</div>
                </div>
            </div>
        </div>

        <!-- Room Not Found Page -->
        <div class="section room-not-found hidden" id="roomNotFound">
            <div style="text-align: center; padding: 40px 20px;">
                <h3 style="color: #e53e3e; margin-bottom: 16px;">‚ùå Room Not Found</h3>
                <p style="color: #718096; margin-bottom: 24px; font-size: 1.1rem;">
                    The room code you entered doesn't exist or has expired.
                </p>
                <div style="background: #fed7d7; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                    <p style="color: #c53030; font-size: 0.9rem; margin: 0;">
                        <strong>Room code:</strong> <span id="invalidRoomCode"
                            style="font-family: monospace; letter-spacing: 1px;"></span>
                    </p>
                </div>
                <button class="btn" id="goBackHomeBtn">üè† Go Back to Home</button>
            </div>
        </div>

        <!-- Hidden role selector (kept for compatibility but not used) -->
        <div class="section role-selector hidden" id="roleSelector"></div>

        <!-- Main Application -->
        <div id="mainApp" class="hidden">
            <div class="connection-status" id="connectionStatus">
                Connecting to server...
            </div>

            <!-- Room Header -->
            <div class="room-header">
                <div class="room-badge">
                    Room: <span id="currentRoomCode" title="Click to copy room URL" style="font-family: monospace; font-size: 0.8rem;"></span>
                </div>
                <div class="room-user-info">
                    <div class="role-indicator" id="roleIndicator"></div>
                    <div id="userInfo" style="color: #718096; font-size: 0.9rem;"></div>
                </div>
                <button class="btn secondary small" id="leaveRoomBtn">Leave Room</button>
            </div>

            <!-- Hidden reset role button -->
            <button class="btn secondary hidden" id="resetRoleBtn"
                style="margin-top: 12px; font-size: 0.8rem; padding: 6px 12px;">Switch Role</button>

            <!-- Admin Controls -->
            <div class="section" id="adminControls">
                <details open style="margin-top: 0;">
                    <summary
                        style="cursor: pointer; font-weight: 600; color: #2d3748; font-size: 1.1rem; margin-bottom: 16px;">
                        üìÅ Content Management</summary>
                    <div style="margin-top: 16px;">
                        <div class="form-group">
                            <label for="fileInput">Upload Video File (Recommended):</label>
                            <input type="file" id="fileInput" accept=".mp4,.mkv,.avi,.webm,.mov" style="margin-bottom: 8px;">
                            <small style="color: #718096;">Supports MP4, MKV, AVI, WebM, MOV - Up to 10GB</small>
                        </div>

                        <button class="btn" id="uploadBtn">üìÅ Upload & Stream Video</button>
                        <button class="btn danger" id="clearMediaBtn">üóëÔ∏è Clear Media</button>

                        <div class="divider"></div>

                        <!-- Subtitle Upload -->
                        <details style="margin-top: 16px;">
                            <summary style="cursor: pointer; font-weight: 500; color: #718096;">üìù Subtitle Management</summary>
                            <div style="margin-top: 12px;">
                                <div class="form-group">
                                    <label for="subtitleInput">Subtitle File:</label>
                                    <input type="file" id="subtitleInput" accept=".srt,.vtt,.ass,.ssa,.sub"
                                        style="margin-bottom: 8px;">
                                    <small style="color: #718096;">Supports SRT, VTT, ASS, SSA, SUB - Up to 5MB</small>
                                </div>

                                <div class="form-group">
                                    <label for="subtitleLanguage">Language (optional):</label>
                                    <input type="text" id="subtitleLanguage" placeholder="e.g., English, Spanish, French">
                                </div>

                                <div class="form-group">
                                    <label for="subtitleLabel">Display Name (optional):</label>
                                    <input type="text" id="subtitleLabel" placeholder="e.g., English SDH, Spanish">
                                </div>

                                <button class="btn secondary" id="uploadSubtitleBtn">üìù Upload Subtitle</button>
                            </div>
                        </details>

                        <div class="divider"></div>

                        <!-- File Library -->
                        <details style="margin-top: 16px;">
                            <summary style="cursor: pointer; font-weight: 500; color: #718096;">üìö File Library</summary>
                            <div style="margin-top: 12px;">
                                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                                    <button class="btn secondary" id="refreshLibraryBtn">üîÑ Refresh Library</button>
                                </div>
                                <div id="libraryStatus" style="margin-top: 8px; font-size: 0.9rem; color: #718096;">Click
                                    refresh to load files</div>

                                <!-- Uploaded Files -->
                                <div id="uploadedFiles" style="margin-top: 16px;">
                                    <h4 style="margin-bottom: 8px; color: #2b6cb0;">üìÅ Uploaded Files</h4>
                                    <div id="uploadedFilesList" class="file-library-list"></div>
                                </div>

                                <!-- Downloaded Files (from torrents) -->
                                <div id="downloadedFiles" style="margin-top: 16px;">
                                    <h4 style="margin-bottom: 8px; color: #22c55e;">‚¨áÔ∏è Downloaded Files</h4>
                                    <div id="downloadedFilesList" class="file-library-list"></div>
                                </div>
                            </div>
                        </details>

                        <div class="divider"></div>

                        <!-- Torrent section (PRIVATE ONLY) -->
                        <details style="margin-top: 16px;">
                            <summary style="cursor: pointer; font-weight: 500; color: #718096;">üß≤ Advanced: Magnet Links
                            </summary>
                            <div style="margin-top: 12px;">
                                <div class="alert warning" style="margin-bottom: 16px;">
                                    <strong>‚ö†Ô∏è Legal Disclaimer:</strong> Users are solely responsible for the content they
                                    stream via torrent links. This platform does not host, store, or distribute any copyrighted
                                    content. Please ensure you have the legal right to access and share any torrents you use.
                                    The platform operators cannot be held liable for any misuse of this feature or copyright
                                    violations.
                                </div>
                                <div class="form-group">
                                    <label for="torrentInput">Magnet Link:</label>
                                    <input type="text" id="torrentInput"
                                        placeholder="magnet:?xt=urn:btih:... (server-side streaming)">
                                </div>
                                <button class="btn secondary" id="loadTorrentBtn">‚ö° Stream via Magnet Link</button>
                            </div>
                        </details>
                    </div>
                </details>
            </div>

            <!-- Player Section -->
            <div class="section">
                <h3>Player</h3>
                <div class="alert success">
                    <strong>üîÑ Auto-Sync:</strong> Any play/pause action or time seeking is automatically synchronized
                    with all users in this room.
                </div>
                <div class="video-container">
                    <video id="videoPlayer" controls preload="metadata" crossorigin="anonymous">
                        Your browser does not support the video tag.
                    </video>
                </div>

                <!-- Basic Controls -->
                <div class="controls">
                    <button class="btn" id="togglePlayBtn">Play/Pause</button>
                    <button class="btn" id="seekBackBtn">-10s</button>
                    <button class="btn" id="seekForwardBtn">+10s</button>
                    <button class="btn" id="fullscreenBtn">Fullscreen</button>
                </div>

                <!-- Admin Controls -->
                <div id="adminPlayerControls" class="hidden">
                    <div class="divider"></div>
                    <div class="controls">
                        <button class="btn secondary" id="syncTimeBtn">üîÑ Force Sync</button>
                        <button class="btn secondary" id="restartBtn">‚èÆÔ∏è Restart</button>
                        <button class="btn secondary" id="rate05Btn">0.5x</button>
                        <button class="btn secondary" id="rate1Btn">1x</button>
                        <button class="btn secondary" id="rate15Btn">1.5x</button>
                    </div>
                </div>

                <!-- Status Grid -->
                <div class="status-grid">
                    <div class="status-card">
                        <h4>Media Status</h4>
                        <p id="mediaStatus">No media loaded</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="status-card">
                        <h4>Room Status</h4>
                        <p id="roomStatus">Connecting...</p>
                        <p id="connectedUsers" style="font-size: 0.85rem; color: #718096; margin-top: 4px;">0 users</p>
                    </div>

                    <div class="status-card">
                        <h4>Sync Status</h4>
                        <p id="syncStatus">Initializing...</p>
                        <p id="lastAction" style="font-size: 0.85rem; color: #718096; margin-top: 4px;">No recent
                            actions
                        </p>
                    </div>
                </div>

                <!-- Torrent Info (PRIVATE ONLY) -->
                <div class="section hidden" id="torrentInfo">
                    <h3>Torrent Details</h3>
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                        <div>
                            <strong>Name:</strong> <span id="torrentName">-</span>
                        </div>
                        <div>
                            <strong>Size:</strong> <span id="torrentSize">-</span>
                        </div>
                        <div>
                            <strong>Downloaded:</strong> <span id="downloaded">-</span>
                        </div>
                        <div>
                            <strong>Speed:</strong> <span id="downloadSpeed">-</span>
                        </div>
                        <div>
                            <strong>Peers:</strong> <span id="numPeers">-</span>
                        </div>
                    </div>
                    <div class="file-list" id="fileList"></div>
                </div>

                <!-- Subtitle Selection -->
                <div class="section" id="subtitleSection" style="display: none;">
                    <h3>Subtitles</h3>

                    <div class="subtitles-list" id="subtitlesList">
                        <div class="subtitle-option selected">
                            <span>No Subtitles</span>
                            <span style="color: #718096; font-size: 0.85rem;">Off</span>
                        </div>
                    </div>
                </div>

                <!-- Connected Users -->
                <div class="section">
                    <h3>Connected Users</h3>
                    <div id="adminUserInstructions"
                        style="display: none; margin-bottom: 12px; padding: 8px; background: #e6fffa; border-left: 3px solid #38b2ac; font-size: 0.85rem;">
                        üëë <strong>Admin tip:</strong> Click on any user to manage them (transfer admin rights or kick
                        from room)
                    </div>
                    <div class="users-list" id="usersList">
                        <div class="user-item">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Tosync Private</h4>
                    <p>Watch together, stay connected</p>
                    <p style="font-size: 0.8rem; color: #718096; margin-top: 8px;">
                        Version 2.3.0 - Built with ‚ù§Ô∏è by Ben Pali
                    </p>
                </div>

                <div class="footer-section">
                    <h4>Resources</h4>
                    <div class="footer-links">
                        <a href="https://github.com/benpali/tosync" target="_blank" rel="noopener noreferrer">
                            üìÇ GitHub Repository
                        </a>
                        <a href="https://github.com/benpali/tosync/issues" target="_blank" rel="noopener noreferrer">
                            üêõ Report Issues
                        </a>
                        <a href="https://github.com/benpali/tosync/blob/main/README.md" target="_blank"
                            rel="noopener noreferrer">
                            üìñ Documentation
                        </a>
                    </div>
                </div>

                <div class="footer-section">
                    <h4>Legal</h4>
                    <div class="footer-disclaimer">
                        <p style="font-size: 0.8rem; color: #718096;">
                            This is a personal project for private usage purposes. Users are responsible for compliance
                            with applicable laws and regulations when using torrent features.
                        </p>
                        <p style="font-size: 0.8rem; color: #718096; margin-top: 8px;">
                            Released under
                            <a href="https://github.com/benpali/tosync/blob/main/LICENSE" target="_blank"
                                rel="noopener noreferrer">
                                MIT License
                            </a>
                        </p>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Tosync. Made for friends and family. Use responsibly.</p>
            </div>
        </footer>

        <!-- Load the main JavaScript module -->
        <script type="module" src="js/main.js"></script>
</body>

</html>
