<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tosync - Watch together, stay connected</title>

    <!-- Socket.IO for real-time communication -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <link rel="stylesheet" href="styles.css">
    <style>
        /* Additional styles for room functionality */
        .room-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .room-option-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .room-option-card:hover {
            border-color: #cbd5e0;
            background: #edf2f7;
        }

        .room-option-card h4 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #2d3748;
        }

        .room-option-card p {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .room-code-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: #2d3748;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 2px;
            font-family: monospace;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            color: white;
            font-size: 1rem;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .room-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #4a5568;
            font-weight: 500;
        }

        .room-badge span {
            background: #2d3748;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-family: monospace;
            letter-spacing: 1px;
        }

        .btn.small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .room-info {
            background: #ebf8ff;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #2b6cb0;
            margin-bottom: 16px;
            text-align: center;
        }

        #roomCodeInput {
            text-align: center;
            font-size: 1.2rem;
            letter-spacing: 2px;
            font-family: monospace;
            text-transform: uppercase;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Tosync</h1>
            <p>Watch together, stay connected</p>
        </div>

        <!-- Room Selection -->
        <div class="section room-selector" id="roomSelector">
            <h3>Join or Create a Room</h3>
            <p style="color: #718096; margin-bottom: 24px;">Start a new room or join an existing one</p>

            <div class="room-options">
                <!-- Create Room Option -->
                <div class="room-option-card">
                    <h4>üé¨ Create New Room</h4>
                    <p>Start your own viewing session as admin</p>
                    <button class="btn" id="createRoomBtn">Create Room</button>
                </div>

                <!-- Join Room Option -->
                <div class="room-option-card">
                    <h4>üîó Join Existing Room</h4>
                    <p>Enter a room code to join</p>
                    <div class="form-group">
                        <input type="text" id="roomCodeInput" placeholder="Enter room code" maxlength="6"
                            style="text-transform: uppercase;">
                    </div>
                    <button class="btn secondary" id="joinRoomBtn">Join Room</button>
                    <div id="joinError" class="alert error hidden" style="margin-top: 12px;">Invalid room code. Please
                        check and try again.</div>
                </div>
            </div>

            <!-- Room Created Info -->
            <div class="room-created-info hidden" id="roomCreatedInfo">
                <div class="alert success">
                    <h4 style="margin-bottom: 8px;">üéâ Room Created Successfully!</h4>
                    <p style="margin-bottom: 12px;">Share this code with your friends:</p>
                    <div class="room-code-display">
                        <span id="roomCodeDisplay"></span>
                        <button class="copy-btn" id="copyCodeBtn" title="Copy room code">üìã</button>
                    </div>
                    <p style="font-size: 0.85rem; color: #22543d; margin-top: 12px;">
                        Room URL: <span id="roomUrlDisplay"></span>
                        <button class="copy-btn" id="copyUrlBtn" title="Copy room URL">üìã</button>
                    </p>
                </div>
                <button class="btn" id="proceedToRoomBtn" style="margin-top: 16px;">Continue to Room</button>
            </div>
        </div>

        <!-- Role Selection (hidden initially) -->
        <div class="section role-selector hidden" id="roleSelector">
            <h3>Choose Access Level</h3>
            <p style="color: #718096; margin-bottom: 8px;">Select how you want to join this session</p>
            <p class="room-info" id="roomInfo"></p>

            <div class="role-buttons">
                <button class="role-btn admin" id="adminBtn">
                    <div style="font-weight: 600; margin-bottom: 4px;">Admin</div>
                    <div style="font-size: 0.8rem; color: #718096;">Manage content</div>
                </button>
                <button class="role-btn guest" id="guestBtn">
                    <div style="font-weight: 600; margin-bottom: 4px;">Guest</div>
                    <div style="font-size: 0.8rem; color: #718096;">Watch & interact</div>
                </button>
            </div>

            <!-- Admin Authentication -->
            <div class="admin-auth hidden" id="adminAuth">
                <h4 style="margin-bottom: 12px; color: #c53030;">Admin Authentication</h4>
                <div class="form-group">
                    <label for="adminPassword">Password:</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <button class="btn" id="authenticateBtn">Authenticate</button>
                <button class="btn secondary" id="cancelAuthBtn">Cancel</button>
                <div id="authError" class="alert error hidden">Incorrect password. Please try again.</div>
            </div>

            <!-- Guest Name Form -->
            <div class="guest-name-form hidden" id="guestNameForm">
                <h4 style="margin-bottom: 12px; color: #2b6cb0;">Guest Setup</h4>
                <div class="form-group">
                    <label for="guestName">Display Name (optional):</label>
                    <input type="text" id="guestName" placeholder="Enter your name or leave blank for Anonymous">
                </div>
                <button class="btn" id="setGuestNameBtn">Continue as Guest</button>
                <button class="btn secondary" id="cancelGuestBtn">Cancel</button>
            </div>

            <button class="btn secondary" id="backToRoomSelectBtn" style="margin-top: 20px;">‚Üê Back to Room
                Selection</button>
        </div>

        <!-- Main Application -->
        <div id="mainApp" class="hidden">
            <div class="connection-status" id="connectionStatus">
                Connecting to server...
            </div>

            <!-- Room Header -->
            <div class="room-header">
                <div class="room-badge">
                    Room: <span id="currentRoomCode"></span>
                </div>
                <button class="btn secondary small" id="leaveRoomBtn">Leave Room</button>
            </div>

            <!-- User Info -->
            <div style="text-align: center; margin-bottom: 24px;">
                <div class="role-indicator" id="roleIndicator"></div>
                <div id="userInfo" style="color: #718096; font-size: 0.9rem;"></div>
                <button class="btn secondary" id="resetRoleBtn"
                    style="margin-top: 12px; font-size: 0.8rem; padding: 6px 12px;">Switch Role</button>
            </div>

            <!-- Admin Controls -->
            <div class="section" id="adminControls">
                <h3>Content Management</h3>

                <div class="form-group">
                    <label for="fileInput">Upload Video File (Recommended):</label>
                    <input type="file" id="fileInput" accept=".mp4,.mkv,.avi,.webm,.mov" style="margin-bottom: 8px;">
                    <small style="color: #718096;">Supports MP4, MKV, AVI, WebM, MOV - Up to 10GB</small>
                </div>

                <button class="btn" id="uploadBtn" style="background: #22c55e;">üìÅ Upload & Stream Video</button>
                <button class="btn danger" id="clearMediaBtn">üóëÔ∏è Clear Media</button>

                <div class="divider"></div>

                <!-- Subtitle Upload -->
                <details style="margin-top: 16px;">
                    <summary style="cursor: pointer; font-weight: 500; color: #718096;">üìù Subtitle Management</summary>
                    <div style="margin-top: 12px;">
                        <div class="form-group">
                            <label for="subtitleInput">Subtitle File:</label>
                            <input type="file" id="subtitleInput" accept=".srt,.vtt,.ass,.ssa,.sub"
                                style="margin-bottom: 8px;">
                            <small style="color: #718096;">Supports SRT, VTT, ASS, SSA, SUB - Up to 5MB</small>
                        </div>

                        <div class="form-group">
                            <label for="subtitleLanguage">Language (optional):</label>
                            <input type="text" id="subtitleLanguage" placeholder="e.g., English, Spanish, French">
                        </div>

                        <div class="form-group">
                            <label for="subtitleLabel">Display Name (optional):</label>
                            <input type="text" id="subtitleLabel" placeholder="e.g., English SDH, Spanish">
                        </div>

                        <button class="btn secondary" id="uploadSubtitleBtn">üìù Upload Subtitle</button>
                    </div>
                </details>

                <div class="divider"></div>

                <!-- File Library -->
                <details style="margin-top: 16px;">
                    <summary style="cursor: pointer; font-weight: 500; color: #718096;">üìö File Library</summary>
                    <div style="margin-top: 12px;">
                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                            <button class="btn secondary" id="refreshLibraryBtn">üîÑ Refresh Library</button>
                        </div>
                        <div id="libraryStatus" style="margin-top: 8px; font-size: 0.9rem; color: #718096;">Click
                            refresh to load files</div>

                        <!-- Uploaded Files -->
                        <div id="uploadedFiles" style="margin-top: 16px;">
                            <h4 style="margin-bottom: 8px; color: #2b6cb0;">üìÅ Uploaded Files</h4>
                            <div id="uploadedFilesList" class="file-library-list"></div>
                        </div>

                        <!-- Downloaded Files -->
                        <div id="downloadedFiles" style="margin-top: 16px;">
                            <h4 style="margin-bottom: 8px; color: #22c55e;">‚¨áÔ∏è Downloaded Files</h4>
                            <div id="downloadedFilesList" class="file-library-list"></div>
                        </div>
                    </div>
                </details>

                <div class="divider"></div>

                <details style="margin-top: 16px;">
                    <summary style="cursor: pointer; font-weight: 500; color: #718096;">üß≤ Advanced: Magnet Links
                    </summary>
                    <div style="margin-top: 12px;">
                        <div class="alert warning" style="margin-bottom: 16px;">
                            <strong>‚ö†Ô∏è Legal Disclaimer:</strong> Users are solely responsible for the content they
                            stream via torrent links. This platform does not host, store, or distribute any copyrighted
                            content. Please ensure you have the legal right to access and share any torrents you use.
                            The platform operators cannot be held liable for any misuse of this feature or copyright
                            violations.
                        </div>
                        <div class="form-group">
                            <label for="torrentInput">Magnet Link:</label>
                            <input type="text" id="torrentInput"
                                placeholder="magnet:?xt=urn:btih:... (server-side streaming)">
                        </div>
                        <button class="btn secondary" id="loadTorrentBtn">‚ö° Stream via Magnet Link</button>
                    </div>
                </details>
            </div>

            <!-- Player Section -->
            <div class="section">
                <h3>Player</h3>
                <div class="alert success">
                    <strong>üîÑ Auto-Sync:</strong> Any play/pause action or time seeking is automatically synchronized
                    with all users in this room.
                </div>
                <div class="video-container">
                    <video id="videoPlayer" controls preload="metadata" crossorigin="anonymous">
                        Your browser does not support the video tag.
                    </video>
                </div>

                <!-- Basic Controls -->
                <div class="controls">
                    <button class="btn" id="togglePlayBtn">Play/Pause</button>
                    <button class="btn" id="seekBackBtn">-10s</button>
                    <button class="btn" id="seekForwardBtn">+10s</button>
                    <button class="btn" id="fullscreenBtn">Fullscreen</button>
                </div>

                <!-- Admin Controls -->
                <div id="adminPlayerControls" class="hidden">
                    <div class="divider"></div>
                    <div class="controls">
                        <button class="btn secondary" id="syncTimeBtn">üîÑ Force Sync</button>
                        <button class="btn secondary" id="restartBtn">‚èÆÔ∏è Restart</button>
                        <button class="btn secondary" id="rate05Btn">0.5x</button>
                        <button class="btn secondary" id="rate1Btn">1x</button>
                        <button class="btn secondary" id="rate15Btn">1.5x</button>
                    </div>
                </div>

                <!-- Status Grid -->
                <div class="status-grid">
                    <div class="status-card">
                        <h4>Media Status</h4>
                        <p id="mediaStatus">No media loaded</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="status-card">
                        <h4>Room Status</h4>
                        <p id="roomStatus">Connecting...</p>
                        <p id="connectedUsers" style="font-size: 0.85rem; color: #718096; margin-top: 4px;">0 users</p>
                    </div>

                    <div class="status-card">
                        <h4>Sync Status</h4>
                        <p id="syncStatus">Initializing...</p>
                        <p id="lastAction" style="font-size: 0.85rem; color: #718096; margin-top: 4px;">No recent
                            actions
                        </p>
                    </div>
                </div>

                <!-- Torrent Info -->
                <div class="section hidden" id="torrentInfo">
                    <h3>Torrent Details</h3>
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
                        <div>
                            <strong>Name:</strong> <span id="torrentName">-</span>
                        </div>
                        <div>
                            <strong>Size:</strong> <span id="torrentSize">-</span>
                        </div>
                        <div>
                            <strong>Downloaded:</strong> <span id="downloaded">-</span>
                        </div>
                        <div>
                            <strong>Speed:</strong> <span id="downloadSpeed">-</span>
                        </div>
                        <div>
                            <strong>Peers:</strong> <span id="numPeers">-</span>
                        </div>
                    </div>
                    <div class="file-list" id="fileList"></div>
                </div>

                <!-- Subtitle Selection -->
                <div class="section" id="subtitleSection" style="display: none;">
                    <h3>Subtitles</h3>

                    <div class="subtitles-list" id="subtitlesList">
                        <div class="subtitle-option selected">
                            <span>No Subtitles</span>
                            <span style="color: #718096; font-size: 0.85rem;">Off</span>
                        </div>
                    </div>
                </div>

                <!-- Connected Users -->
                <div class="section">
                    <h3>Connected Users</h3>
                    <div class="users-list" id="usersList">
                        <div class="user-item">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Tosync</h4>
                    <p>Watch together, stay connected</p>
                    <p style="font-size: 0.8rem; color: #718096; margin-top: 8px;">
                        Version 2.1.0 - Built with ‚ù§Ô∏è by Ben Pali
                    </p>
                </div>

                <div class="footer-section">
                    <h4>Resources</h4>
                    <div class="footer-links">
                        <a href="https://github.com/benpali/tosync" target="_blank" rel="noopener noreferrer">
                            üìÇ GitHub Repository
                        </a>
                        <a href="https://github.com/benpali/tosync/issues" target="_blank" rel="noopener noreferrer">
                            üêõ Report Issues
                        </a>
                        <a href="https://github.com/benpali/tosync/blob/main/README.md" target="_blank"
                            rel="noopener noreferrer">
                            üìñ Documentation
                        </a>
                    </div>
                </div>

                <div class="footer-section">
                    <h4>Legal</h4>
                    <div class="footer-disclaimer">
                        <p style="font-size: 0.8rem; color: #718096;">
                            This is a personal project for private usage purposes. Users are responsible for compliance
                            with applicable laws and regulations when using torrent features.
                        </p>
                        <p style="font-size: 0.8rem; color: #718096; margin-top: 8px;">
                            Released under
                            <a href="https://github.com/benpali/tosync/blob/main/LICENSE" target="_blank"
                                rel="noopener noreferrer">
                                MIT License
                            </a>
                        </p>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Tosync. Made for friends and family. Use responsibly.</p>
            </div>
        </footer>

        <!-- Load the main JavaScript module -->
        <script type="module" src="js/main.js"></script>
</body>

</html>